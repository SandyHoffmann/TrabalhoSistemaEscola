<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Trabalho</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <link
      rel="shortcut icon"
      href="https://img.icons8.com/ios/250/000000/classroom.png"
    />
    
      <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300&display=swap" rel="stylesheet">
      
    <link rel="stylesheet" href="css.css" />
    <link rel="stylesheet" href="css2.css" />
    <link rel="stylesheet" href="cssindex2.css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/8071d324a2.js" crossorigin="anonymous"></script>

  </head>
  <body>
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target="#myNavbar"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">School</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul
            id="Home"
            class="nav navbar-nav"
          >
            <li class="active">
              <a href="index.html">Home</a>
            </li>
          <ul class="nav navbar-nav navbar-right">
          </ul>
        </div>
      </div>
    </nav>
    <div class="container" id="containerbd">
   <center> <h1 class="nomeTurma"></h1>
    <h2 class="codigoTurma"></h2></center>
    <div class="corpoPag">
      <div class="textoInv"><p>Os alunos cadastrados irão aparecer abaixo, no seguinte formato de tabela:</p></div>
  <section class="container">
      <table class="tabela" id="tabela">
        <tr>
          <th scope="col">Matrícula</th>
          <th scope="col">Nome</th>
          <th scope="col" class = "esconder">Nota 1</th>
          <th scope="col" class = "esconder">Nota 2</th>
          <th scope="col" class = "esconder">Nota 3</th>
          <th scope="col" class = "esconder">Média Final</th>
          <th scope="col">Deletar</th>
        </tr>
      </table>
    </section>
  <br>
    </div>
    <div class="mais">
      <button type="button" class="btn btn" id="botaomaisAluno" data-toggle="modal" data-target=".bd-example-modal-lg-m">+</button>
    </div>
  </div>
    <div class="modal fade bd-example-modal-lg-m" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="titulo-cadastro">
            <h1>Cadastrar novos alunos</h1>
          </div>
          <form>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="inputMatricula4">Matrícula</label>
                <input type="text" class="form-control" id="inputMatricula4" placeholder="Digite a matrícula do aluno" required maxlength="10" minlength="2">
              </div>
              <div class="form-group col-md-6">
                <label for="inputTelefone4">Telefone</label>
                <input type="text" class="form-control" id="inputTelefone4" placeholder="Digite o número do telefone do aluno" required maxlength="20" minlength="2">
              </div>
            </div>
            <div class="form-group">
              <label for="inputNome">Nome</label>
              <input type="text" class="form-control" id="inputNome" placeholder="Digite o nome do aluno" required maxlength="15" minlength="2">
            </div>
            <div class="form-group">
              <label for="inputEmail">E-mail</label>
              <input type="email" class="form-control" id="inputEmail" placeholder="Digite o e-mail do aluno" required maxlength="20" minlength="2">
            </div>
            <div class="form-group" id="centralizarBotao">
            <button type="submit" class="btn btn" id="botaoAluno">Enviar</button>
            </div>
          </form>

        </div>
      </div>
    </div>
    <footer class="page-footer site-footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <h6>Sobre</h6>
            <p class="text-justify">
              Somos um grupo institucional renomado em termos educacionais. Prezamos pelo bem
              estar dos alunos, lhes proporcionando as melhores aulas com os profissionais mais
              qualificados. Venha crescer com a gente!
            </p>
          </div>

          <div class="col-xs-6 col-md-3">
            <h6 style="text-align: center;">Contatos Educacionais</h6>
            <ul class="footer-links">
              <li><a href="#">(47) 3333-4360</a></li>
              <li><a href="#">(45) 3386-4890</a></li>
              <li><a href="#">(49) 3348-5678</a></li>
            </ul>
          </div>
          <div>
            <h6 style="text-align: center;">Links Importantes</h6>
            <ul class="footer-links">
              <li><a href="#">Educação no Brasil</a></li>
              <li><a href="#">Normas Estudantis</a></li>
              <li><a href="#">Contrata-se</a></li>
            </ul>
          </div>
        </div>
        <hr />
      </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-6 col-xs-12">
            <p class="copyright-text">Copyright by School</p>
          </div>
          <div>
            <ul class="social-icons">
              <li>
                <a class="facebook" href="#"><i class="fab fa-facebook"></i></a>
              </li>
              <li>
                <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
              </li>
              <li>
                <a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a>
              </li>
              <li>
                <a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script type="module">
      //importações
      import { Aluno } from './js/aluno.js'
      import { Turma } from './js/turma.js'
      import { armazenarValores, instanciaAlunos, instanciaTurmas } from './js/backend.js'
      //espero um tempo para iniciar a função iniciar
      let timer2 = setTimeout(iniciar, 2)
      // @ts-check

      /**
       * Função coloca os dados na página em forma de tabela.
       */

      function iniciar() {
          //Pegando valores de URL
          let query = new URLSearchParams(location.search)
          let idTurma = query.get("codigoTurma")
          //Pegando dados do storage
          let turma = JSON.parse(localStorage.getItem("listaTurmas"))
          //Pegando os seletores
          let pNomeTurma = document.querySelector(".nomeTurma")
          let pCodTurma = document.querySelector(".codigoTurma")
          //Chamando funções para instanciar objetos de turmas e alunos
          let turmasIns = instanciaTurmas(turma)
          let alunosIns = instanciaAlunos(turma)
          //Percorrendo lista de objetos de aluno
          for (let x = 0; x<turmasIns.length; x++) {
              if (turmasIns[x].codigoTurma == idTurma) {
                  //Colocando informações no cabeçalho
                  pNomeTurma.textContent = turmasIns[x].nomeTurma
                  pCodTurma.textContent = turmasIns[x].codigoTurma
                  //Selecionando tabela e texto
                  let tabela = document.querySelector("table")
                  let alunoP = document.querySelector(".textoInv")
                    //Percorrendo alunos da turma
                    for (let z=0;z<turmasIns[x].alunos.length;z++){
                        //Se tiver alunos não preciso de aviso que não há alunos
                        alunoP.hidden = true
                        //Crio uma fileira na tabela
                        let fileira = document.createElement("tr")
                        //Adiciono-a na tabela
                        tabela.append(fileira)
                        //Crio a tabela checando se o aluno possui notas ou não e adicionando a funcionalidade de deletar a cada botão de deletar, a class esconder é para ficar melhor no mobile.
                          let a = document.createElement("a")
                          fileira.innerHTML += `<td><a href="pagCarteirinha.html?matricula=${turmasIns[x].alunos[z].matricula}">${turmasIns[x].alunos[z].matricula}</a></td>`
                          fileira.innerHTML += `<td>${turmasIns[x].alunos[z].nome}</td>`
                          if (turmasIns[x].alunos[z].nota[0]){
                            fileira.innerHTML += `<td class = "esconder">${turmasIns[x].alunos[z].nota[0]}</td>`
                            fileira.innerHTML += `<td class = "esconder">${turmasIns[x].alunos[z].nota[1]}</td>`
                            fileira.innerHTML += `<td class = "esconder">${turmasIns[x].alunos[z].nota[2]}</td>`
                            fileira.innerHTML += `<td class = "esconder">${turmasIns[x].alunos[z].media}</td>`
                          } else{
                            fileira.innerHTML += `<td class = "esconder">Não se tem Notas</td>`
                            fileira.innerHTML += `<td class = "esconder">Não se tem Notas</td>`
                            fileira.innerHTML += `<td class = "esconder">Não se tem Notas</td>`
                            fileira.innerHTML += `<td class = "esconder">Não se tem Notas</td>`
                          }
                          fileira.innerHTML += `<td><a id = "${turmasIns[x].alunos[z].matricula}" class = "Deletar">deletar</a></td>`
                          let deletar = document.querySelectorAll(".Deletar")[z]
                          deletar.addEventListener("click", function () { deletando(deletar.id) })
                  }
                  
              }
          }
      }
      //Botao de adicionar aluno
      let botao = document.querySelector("#botaoAluno")
      //Adicionando evento de click
      botao.addEventListener("click", (event) => {
          //Pegando informações de query e instanciando turmas e alunos
          let query = new URLSearchParams(location.search)
          let idTurma = query.get("codigoTurma")
          let turma2 = JSON.parse(localStorage.getItem("listaTurmas"))
          let turmasInst = instanciaTurmas(turma2)
          let alunosInst = instanciaAlunos(turma2)
          //Pegando valores de input
          let cont1 = document.querySelector("#inputMatricula4").value
          let cont2 = document.querySelector("#inputNome").value
          let cont3 = document.querySelector("#inputTelefone4").value
          let cont4 = document.querySelector("#inputEmail").value
          //Se há o minimo necessário cadastrando alunos
          if (cont1.length>1 && cont2.length>1){
            //Percorrendo turma
            for (let x of turmasInst) {
                if (x.codigoTurma == idTurma) {
                    //Adicionando aluno na turma
                    let input1 = document.querySelector("#inputMatricula4").value
                    let input2 = document.querySelector("#inputNome").value
                    let input3 = document.querySelector("#inputTelefone4").value
                    let input4 = document.querySelector("#inputEmail").value
                    let aluno = new Aluno(input1,input2,input3,input4)
                    document.querySelector("#inputMatricula4").value = ''
                    document.querySelector("#inputNome").value = ''
                    document.querySelector("#inputTelefone4").value = ''
                    document.querySelector("#inputEmail").value = ''
                    x.cadastrarAluno(aluno)
                    armazenarValores(turmasInst)
                }
            }
          }
      })

       /**
       * Função que deleta os alunos, coloquei separado por quisitos de organização
       * @param {string} deletar - matricula do aluno.
       */

      function deletando(deletar) {
          //Pegando informações de query e instanciando turmas e alunos
          let query = new URLSearchParams(location.search)
          let idTurma = query.get("codigoTurma")
          let tag = document.getElementById(deletar)
          let turma2 = JSON.parse(localStorage.getItem("listaTurmas"))
          let turmasInst = instanciaTurmas(turma2)
          let alunosInst = instanciaAlunos(turma2)
          //Percorrendo turmas
          for (let x of turmasInst) {
            //Achando a turma
            if (x.codigoTurma == idTurma) {
              //percorrendo alunos DAQUELA turma
              for (let y of x.alunos){
                    //Se achar aluno, o remover
                    let matricula = tag.id
                    for (let i = 0; i < x.alunos.length; i++) {
                        if (y.matricula == deletar) {
                            x.removerAluno(matricula)
                            armazenarValores(turmasInst)
                        }
                    }}
                }
          }
      }
  </script>
  </body>
</html>
