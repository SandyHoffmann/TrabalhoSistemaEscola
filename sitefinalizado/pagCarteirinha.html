<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Trabalho</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    />
    <link
      rel="shortcut icon"
      href="https://img.icons8.com/ios/250/000000/classroom.png"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css2.css" />
    <link rel="stylesheet" href="css.css" />
    <link rel="stylesheet" href="cssindex2.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/8071d324a2.js" crossorigin="anonymous"></script>

  </head>
  <body>
    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target="#myNavbar"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">School</a>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul
            id="Home"
            class="nav navbar-nav"
          >
            <li class="active">
              <a href="index.html">Home</a>
            </li>
          <ul class="nav navbar-nav navbar-right">
          </ul>
        </div>
      </div>
    </nav>
    <div class="container" id="containerbd">
    <div class="carteira">
      <h4 class="nome-estudante">Nome do Estudante</h4>
      <img class="img" src="default-user-image.png" alt="icone" />
      <h4 class="matricula">Matrícula</h4>
      <h4 class="email">Email</h4>
      <h4 class="telefone">Telefone</h4>
      <div class="notas">
        <div>
          <p>Nota 1</p>
          <h4 class="n1"></h4>
        </div>
        <div>
          <p>Nota 2</p>
          <h4 class="n2"></h4>
        </div>
        <div>
          <p>Nota 3</p>
          <h4 class="n3"></h4>
        </div>

      </div>
        <div>
          <p>Media</p>
          <h4 class="media"></h4>
        </div>
      <div>
        <button type="button" class="btn btn botao2" data-toggle="modal" data-target=".bd-example-modal-lg-m" id="botao">Editar Informações/Colocar Notas</button>
      </div>
    </div>
    </div>
    <div class="escondido">
      <button type="button" class="btn btn" data-toggle="modal" data-target=".bd-example-modal-lg-m" id="botaoenviar">Editar Informações/Colocar Notas</button>
    </div>
    <div class="modal fade bd-example-modal-lg-m" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="titulo-cadastro">
            <h1>Editar Aluno</h1>
          </div>
          <form>
            <div class="form-group">
              <div class="form-group col-md-6">
                <label for="inputTelefone4">Telefone</label>
                <input type="telefone" class="form-control" id="inputTelefone" placeholder="Digite o número do telefone do aluno">
              </div>
            <div class="form-group col-md-6">
              <label for="inputNome">Nome</label>
              <input type="nome" class="form-control" id="inputNome" placeholder="Digite o nome do aluno">
            </div>
            <div class="form-group">
              <label for="inputEmail">E-mail</label>
              <input type="text" class="form-control" id="inputEmail" placeholder="Digite o e-mail do aluno">
          </div>
            <div class="form-group" style="display: flex; justify-content: space-between;">
              <div class="form-group col-md-3">
              <label for="n1">Nota 1</label>
              <input type="number" class="form-control" id="n1" placeholder="Nota 1">
              </div>
              <div class="form-group col-md-3">
              <label for="n2">Nota 2</label>
              <input type="number" class="form-control" id="n2" placeholder="Nota 2">
            </div>
            <div class="form-group col-md-3">
              <label for="n3">Nota 3</label>
              <input type="number" class="form-control" id="n3" placeholder="Nota 3">
            </div>
            </div>
            <div class="form-group" id="centralizarBotao">
            <a type="submit" class="btn btn" id="botaoAluno">Enviar</a>
            </div>
          </form>
          </div>
        </div>
      </div>
    </div>
    <footer class="page-footer site-footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <h6>Sobre</h6>
            <p class="text-justify">
              Somos um grupo institucional renomado em termos educacionais. Prezamos pelo bem
              estar dos alunos, lhes proporcionando as melhores aulas com os profissionais mais
              qualificados. Venha crescer com a gente!
            </p>
          </div>

          <div class="col-xs-6 col-md-3">
            <h6 style="text-align: center;">Contatos Educacionais</h6>
            <ul class="footer-links">
              <li><a href="#">(47) 3333-4360</a></li>
              <li><a href="#">(45) 3386-4890</a></li>
              <li><a href="#">(49) 3348-5678</a></li>
            </ul>
          </div>
          <div>
            <h6 style="text-align: center;">Links Importantes</h6>
            <ul class="footer-links">
              <li><a href="#">Educação no Brasil</a></li>
              <li><a href="#">Normas Estudantis</a></li>
              <li><a href="#">Contrata-se</a></li>
            </ul>
          </div>
        </div>
        <hr />
      </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-6 col-xs-12">
            <p class="copyright-text">Copyright by School</p>
          </div>
          <div>
            <ul class="social-icons">
              <li>
                <a class="facebook" href="#"><i class="fab fa-facebook"></i></a>
              </li>
              <li>
                <a class="twitter" href="#"><i class="fa fa-twitter"></i></a>
              </li>
              <li>
                <a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a>
              </li>
              <li>
                <a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>

    <script type="module">
      //importações
      import { Turma } from './js/turma.js'
      import { armazenarValores, instanciaAlunos, instanciaTurmas } from './js/backend.js'
      //pego valores dos inputs
      let input2 = document.querySelector("#inputNome")
      let input3 = document.querySelector("#inputEmail")
      let input4 = document.querySelector("#inputTelefone")
      let input5 = document.querySelector("#n1")
      let input6 = document.querySelector("#n2")
      let input7 = document.querySelector("#n3")
      
      //adiciono evento ao carregar a pagina
      window.addEventListener("load", () => {
          //esse evento faz com que os dados da pagina sejam de acordo com a url da matricula do aluno
          let query = new URLSearchParams(location.search)
          let matricula = query.get("matricula")
          let turma = JSON.parse(localStorage.getItem("listaTurmas"))
          let lista_turmas = instanciaTurmas(turma)
          let lista_alunos = instanciaAlunos(turma)
          //Percorrendo turmas instanciadas
          for (let x of lista_turmas){
              //Percorrendo alunos instanciados
              for (let aluno of x.alunos){
                  //Se achar aluno, bota-lo na carteirinha e colocar dados default no form
                  if (aluno.matricula == matricula){
                      console.log(aluno.matricula)
                      document.querySelector(".matricula").textContent = aluno.matricula
                      document.querySelector(".nome-estudante").textContent = aluno.nome
                      document.querySelector(".email").textContent = aluno.email
                      document.querySelector(".telefone").textContent = aluno.telefone
                      input2.value = aluno.nome
                      input3.value = aluno.email
                      input4.value = aluno.telefone
                      console.log(aluno)
                      if (aluno.nota){
                        document.querySelector(".n1").textContent = aluno.nota[0]
                        document.querySelector(".n2").textContent = aluno.nota[1]
                        document.querySelector(".n3").textContent = aluno.nota[2]
                        document.querySelector(".media").textContent = aluno.media
                      }
                  }
              }}
          })
      
      //botao de mudar informações de aluno
      let botao = document.querySelector("#botaoAluno")
      //Adicionando evento ao botão
      botao.addEventListener("click", (event) => {
          //Pegando informações de query e instanciando turmas e alunos
          let query = new URLSearchParams(location.search)
          let matricula = query.get("matricula")
          let turma2 = JSON.parse(localStorage.getItem("listaTurmas"))
          let lista_turmas = instanciaTurmas(turma2)
          let lista_alunos = instanciaAlunos(turma2)
            //Percorrendo turmas
            for (let x of lista_turmas) {
                for (let i = 0; i < x.alunos.length; i++) {
                    //Achando aluno para editar
                    if (x.alunos[i].matricula == matricula) {
                      //Editando info
                        x.alunos[i].editarInformacoes(input2.value, input3.value, input4.value)
                        //Se tiver nota, editando nota
                        if (input7.value){
                          x.alunos[i].cadastraNotas(input5.value,input6.value,input7.value)
                          x.alunos[i].calculaMedia()
                          }
                          //Limpando campos afim de evitar erros.
                          document.querySelector("#inputEmail").value = ''
                          document.querySelector("#inputNome").value = ''
                          document.querySelector("#inputTelefone").value = ''
                    }
                }
                armazenarValores(lista_turmas)
            }
          })

    </script>
  </body>
</html>
