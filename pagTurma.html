<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p class="id"></p>
    <p class="nome"></p>
    <input type="text" class="matricula">
    <input type="text" class="nomeinput">
    <input type="text" class="telefone">
    <input type="text" class="email">   
    <button>Clique</button>

    <script type="module">
        import { Aluno } from './js/aluno.js'
        import { Turma } from './js/turma.js'
        import { criarInst, classesInitTurma, classesInitAlunos, armazenarValores } from './js/backend.js'
        let timer1 = setTimeout(criarInst,1)
        let timer2 = setTimeout(iniciar, 2)
        console.log(classesInitTurma)
        function iniciar() {
            let query = new URLSearchParams(location.search)
            let idTurma = query.get("codigoTurma")
            let turma = JSON.parse(localStorage.getItem("listaTurmas"))
            console.log(classesInitTurma[0])
            let cont = -1
            for (let x of classesInitTurma) {
                cont+=1
                if (x.codigoTurma == idTurma) {
                    document.querySelector(".id").textContent = x.codigoTurma
                    document.querySelector(".nome").textContent = x.nomeTurma
                    console.log(classesInitAlunos)
                    for (let y = 0; y < classesInitAlunos.length; y++){
                        for (let z=0;z<classesInitAlunos[y].length;z++){
                            let a = document.createElement("a")
                            let deletar = document.createElement("a")
                            console.log(classesInitAlunos[y][z].matricula)
                            deletar.id = classesInitAlunos[y][z].matricula
                            deletar.classList.add("deletar")
                            a.href = `pagAlunos.html?matricula=${classesInitAlunos[y][z].matricula}`
                            a.innerHTML = "<br>" + classesInitAlunos[y][z].nome
                            deletar.innerHTML = "---" + "Deletar" + "<br>"
                            deletar.addEventListener("click", function () { deletando(classesInitAlunos[y][z].matricula) })
                            document.body.append(a)
                            document.body.append(deletar)
                    }
                    }
                }
            }
        }
        let botao = document.querySelector("button")
        botao.addEventListener("click", (event) => {
            let query = new URLSearchParams(location.search)
            let idTurma = query.get("codigoTurma")
            let turma2 = JSON.parse(localStorage.getItem("listaTurmas"))
            console.log(classesInitTurma)
            for (let x of classesInitTurma) {
                console.log(x)
                if (x.codigoTurma == idTurma) {
                    let input1 = document.querySelector(".matricula").value
                    let input2 = document.querySelector(".nomeinput").value
                    let input3 = document.querySelector(".telefone").value
                    let input4 = document.querySelector(".email").value

                    alert(input1)
                    let aluno = new Aluno(input1,input2,input3,input4)
                    alert(aluno.matricula)
                    x.cadastrarAluno(aluno)
                    console.log(classesInitTurma)
                    armazenarValores(classesInitTurma)
                    return "ok"
                }
            }
            console.log(turma)
        })
        function deletando(deletar) {
            console.log(deletar)
            let query = new URLSearchParams(location.search)
            let idTurma = query.get("codigoTurma")
            let tag = document.getElementById(deletar);
            for (let x of classesInitTurma) {
                if (x.codigoTurma == idTurma) {
                    let matricula = tag.id
                    console.log(deletar)
                    for (let i = 0; i < x.alunos.length; i++) {
                        if (x.alunos[i].matricula == deletar) {
                            alert("a")
                            x.removerAluno(matricula)
                            armazenarValores(classesInitTurma)
                        }
                    }
                }
            }
        }
    </script>

</body>

</html>